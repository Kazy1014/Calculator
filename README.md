# 高度な電卓アプリケーション

Nuxt 3とTypeScriptで構築された、高度な科学計算機能を持つWebアプリケーションです。

## 🎯 特徴

### 基本機能
- ✅ 四則演算（+, -, ×, ÷）
- ✅ 括弧を使った複雑な計算
- ✅ 小数点計算
- ✅ バックスペース機能（1文字削除）
- ✅ クリア機能

### 科学計算機能
- ✅ 三角関数：sin, cos, tan, asin, acos, atan
- ✅ 対数関数：log（常用対数）、ln（自然対数）
- ✅ その他：sqrt（平方根）、abs（絶対値）
- ✅ 累乗計算：x^y
- ✅ 角度モード切り替え（度/ラジアン）

### 計算履歴
- ✅ 最新20件の計算履歴を保持
- ✅ 履歴エントリをクリックして数式を再利用
- ✅ 履歴のクリア機能
- ✅ タイムスタンプ付き履歴表示

### メモリ機能
- ✅ **AC (All Clear and Save)**: 現在の値をメモリに保存
- ✅ **MR (Memory Recall)**: メモリから値を呼び出し
- ✅ **MC (Memory Clear)**: メモリをクリア
- ✅ メモリインジケーター表示

### 数値フォーマット
- ✅ 1,000単位のカンマ区切り表示
- ✅ 12桁を超える数値は科学的記数法で表示
- ✅ 整数部と小数部の合計桁数制限（最大12桁）

### ユーザーインターフェース
- ✅ 左右2カラムレイアウト
  - 左側（40%）: 計算履歴パネル
  - 右側（60%）: 電卓コンソール
- ✅ レスポンシブデザイン（モバイル対応）
- ✅ フラットデザインの丸みを帯びたボタン
- ✅ ボタン押下時の視覚的フィードバック

### 操作方法
- ✅ マウス/タッチ操作
- ✅ キーボードショートカット対応
  - 数字: 0-9
  - 演算子: +, -, *, /
  - 括弧: (, )
  - Enter: 計算実行
  - Escape: クリア
  - Backspace: 1文字削除

## 🏗️ アーキテクチャ

### DDD (Domain-Driven Design) 4層アーキテクチャ

```
src/
├── domain/              # ドメイン層
│   ├── entities/        # エンティティ
│   ├── value-objects/   # 値オブジェクト
│   ├── services/        # ドメインサービス
│   └── repositories/    # リポジトリインターフェース
├── application/         # アプリケーション層
│   ├── dto/             # データ転送オブジェクト
│   └── use-cases/       # ユースケース
├── infrastructure/      # インフラ層
│   └── repositories/    # リポジトリ実装
└── presentation/        # プレゼンテーション層
    ├── composables/     # Vue Composables
    └── components/      # Vueコンポーネント（※）

※ components/は技術的にはルートにありますが、論理的にはプレゼンテーション層
```

#### 主要コンポーネント

**ドメイン層**:
- `Expression`: 数式を表現する値オブジェクト
- `Token`: 数式を構成する要素（数値、演算子、関数、括弧）
- `ExpressionParser`: Shunting-yard algorithmを使用した数式パーサー
- `CalculationEngine`: 逆ポーランド記法（RPN）の評価エンジン
- `ScientificCalculator`: 科学計算機能
- `NumberFormatter`: 数値フォーマッター
- `CalculationHistory`: 計算履歴管理
- `MemoryStorage`: メモリストレージ
- `UnitConverter`: 単位変換（長さ、重さ、温度、体積）

**アプリケーション層**:
- 各種Use Cases: 計算、履歴、メモリ、科学計算、単位変換
- DTOs: レイヤー間のデータ転送

**インフラ層**:
- InMemoryHistoryRepository: メモリ上の履歴保存
- InMemoryMemoryRepository: メモリ上のメモリ保存

**プレゼンテーション層**:
- useCalculatorV2: 電卓ロジックを統合するComposable
- MainLayout: メインレイアウト
- HistoryPanel: 履歴パネル
- CalculatorConsole: 電卓コンソール

## 🚀 セットアップ

### 必要な環境
- Node.js 18以上
- npm 9以上

### インストール

```bash
npm install
```

### 開発サーバー起動

```bash
npm run dev
```

ブラウザで http://localhost:3000 にアクセス

### ビルド

```bash
npm run build
```

### 本番環境プレビュー

```bash
npm run preview
```

## 🧪 テスト

### ユニットテスト実行

```bash
npm test
```

### ユニットテスト（Watch モード）

```bash
npm run test:watch
```

### テストカバレッジ

```bash
npm run test:coverage
```

### E2Eテスト実行

```bash
npm run test:e2e
```

### E2Eテスト（UIモード）

```bash
npm run test:e2e:ui
```

## 📊 テストカバレッジ

- **ユニットテスト**: 70+テスト
  - Domain層の値オブジェクト、エンティティ
  - ドメインサービス（パーサー、エンジン、フォーマッター）
  - Use Cases
  - コンポーネントテスト

- **E2Eテスト**: 35テスト
  - 基本機能（5テスト）
  - 四則演算（6テスト）
  - 括弧計算（2テスト）
  - 計算履歴（3テスト）
  - キーボード操作（5テスト）
  - 数値フォーマット（2テスト）
  - 科学計算機能（4テスト）
  - UI要素の存在確認（5テスト）
  - レスポンシブ表示（3テスト）

## 📖 使用方法

### 基本的な計算

1. 数字ボタンをクリックまたはキーボードで数字を入力
2. 演算子ボタンをクリックまたはキーボードで演算子を入力
3. `=` ボタンまたはEnterキーで計算実行

### 括弧を使った計算

```
例: (5+5)*2 = 20
```

1. `(` ボタンをクリック
2. 数式を入力
3. `)` ボタンをクリック
4. 続けて演算を入力

### 科学計算

1. 科学関数ボタン（sin, cos, tan, log, ln, √）をクリック
2. 自動的に `関数名(` が入力される
3. 値を入力
4. `)` ボタンをクリック（または自動補完）
5. `=` で計算実行

**例**: sin(30) = 0.5 (度モードの場合)

### メモリ機能

1. **値を保存**: 計算後に `AC` ボタンをクリック
2. **値を呼び出し**: `MR` ボタンをクリック
3. **メモリクリア**: `MC` ボタンをクリック

### 計算履歴

- 自動的に履歴パネルに最新20件が表示されます
- 履歴エントリをクリックすると、その数式が再入力されます
- 「すべてクリア」ボタンで履歴をクリアできます

## 🎨 技術スタック

- **フレームワーク**: Nuxt 3
- **言語**: TypeScript
- **UIライブラリ**: Vue 3 (Composition API)
- **テスト**:
  - Vitest (ユニット・コンポーネントテスト)
  - Playwright (E2Eテスト)
  - @vue/test-utils (コンポーネントテスト)
- **開発環境**: happy-dom
- **アルゴリズム**: Shunting-yard algorithm (数式パーサー)

## 📝 設計原則

- **Domain-Driven Design (DDD)**: ドメインロジックとインフラストラクチャの分離
- **Test-Driven Development (TDD)**: テストファースト開発
- **Clean Architecture**: 依存性逆転の原則
- **SOLID原則**: 単一責任、開放閉鎖、依存性注入など

## 🔮 今後の拡張可能性

実装済みだが未使用の機能：
- 単位変換機能（長さ、重さ、温度、体積）
  - インフラは実装済み
  - UIの追加で有効化可能

拡張可能な機能：
- 計算履歴のローカルストレージ永続化
- グラフ描画機能
- 統計関数（平均、標準偏差など）
- プログラマブルモード（2進数、16進数）
- テーマ切り替え

## 📄 ライセンス

MIT

## 👨‍💻 開発者

開発者: Mitsubishi CC Study Project
